<?xml version="1.0"?>
<project name="mRUBiS" default="build" basedir=".">

	<property file="build.properties" />

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- The classpath used for the compilation process.			-->
	<!-- ========================================================== -->
	<path id="classpath">
		<pathelement location="${basedir}" />
		<fileset dir="${glassfish.lib}">
			<include name="javaee.jar" />
		</fileset>
	</path>
	<property name="build.classpath" refid="classpath" />

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- Target to check the environment (Java 6 is required).		-->
	<!-- ========================================================== -->
	<target name="checkEnv">
		<echo>================================================</echo>
		<echo>JAVA_HOME is set to ${java.home}				</echo>
		<echo>================================================</echo>

		<condition property="env.is.java6" value="true" else="false">
			<contains string="${java.home}" substring="1.6" />
		</condition>

		<fail unless="${env.is.java6}" message="Compiling mRUBiS requires Java 6. JAVA_HOME must be set to a Java 6 distribution." />

		<echo>================================================</echo>
		<echo>Requirment of having Java 6 is fulfilled.		</echo>
		<echo>================================================</echo>

	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- Default target to trigger the complete build process. 	  	-->
	<!-- ========================================================== -->
	<target name="build" if="${env.is.java6}" depends="checkEnv">
		<antcall target="clean" />
		<antcall target="prepare" />
		<antcall target="compile" />
		<antcall target="package" />
		<antcall target="distribute" />
	</target>

	<!-- ========================================================== -->
	<!-- Deletes the folders for the generated jar files and		-->
	<!-- for the binaries. The folders and the generated files		-->
	<!-- and binaries contained in the folders are also deleted.	-->
	<!-- ========================================================== -->
	<target name="clean">
		<echo>Cleaning folders...</echo>

		<delete dir="${folder.dist}" />

		<delete dir="${projectfolder.businessObjects}/${folder.bin}" />
		<delete dir="${projectfolder.businessObjects}/${folder.dist}" />

		<delete dir="${projectfolder.contracts}/${folder.bin}" />
		<delete dir="${projectfolder.contracts}/${folder.dist}" />

		<delete dir="${projectfolder.entities}/${folder.bin}" />
		<delete dir="${projectfolder.entities}/${folder.dist}" />

		<delete dir="${projectfolder.persistenceService}/${folder.bin}" />
		<delete dir="${projectfolder.persistenceService}/${folder.dist}" />

		<delete dir="${projectfolder.queryService}/${folder.bin}" />
		<delete dir="${projectfolder.queryService}/${folder.dist}" />

		<delete dir="${projectfolder.authService}/${folder.bin}" />
		<delete dir="${projectfolder.authService}/${folder.dist}" />

		<delete dir="${projectfolder.userMgmt}/${folder.bin}" />
		<delete dir="${projectfolder.userMgmt}/${folder.dist}" />

		<delete dir="${projectfolder.itemMgmt}/${folder.bin}" />
		<delete dir="${projectfolder.itemMgmt}/${folder.dist}" />

		<delete dir="${projectfolder.bidAndBuyService}/${folder.bin}" />
		<delete dir="${projectfolder.bidAndBuyService}/${folder.dist}" />

		<delete dir="${projectfolder.reputationService}/${folder.bin}" />
		<delete dir="${projectfolder.reputationService}/${folder.dist}" />

		<delete dir="${projectfolder.inventoryMgmt}/${folder.bin}" />
		<delete dir="${projectfolder.inventoryMgmt}/${folder.dist}" />

		<delete dir="${projectfolder.lastSecondSalesItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.lastSecondSalesItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.pastSalesItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.pastSalesItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.buyNowItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.buyNowItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.availabilityItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.availabilityItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.regionItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.regionItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.sellerReputationItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.sellerReputationItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.commentItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.commentItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.categoryItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.categoryItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.recommendationItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.recommendationItemFilter}/${folder.dist}" />

		<delete dir="${projectfolder.futureSalesItemFilter}/${folder.bin}" />
		<delete dir="${projectfolder.futureSalesItemFilter}/${folder.dist}" />
	</target>

	<!-- ========================================================== -->
	<!-- Creates the folders for the generated jar files and 		-->
	<!-- for the binaries. The folders are removed by the clean		-->
	<!-- target.													-->
	<!-- ========================================================== -->
	<target name="prepare">
		<echo>Preparing...</echo>

		<mkdir dir="${folder.dist}" />

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.businessObjects}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.contracts}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.entities}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.persistenceService}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.queryService}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.authService}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.userMgmt}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.itemMgmt}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.bidAndBuyService}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.reputationService}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.inventoryMgmt}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.lastSecondSalesItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.pastSalesItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.buyNowItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.availabilityItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.regionItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.sellerReputationItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.commentItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.categoryItemFilter}" />
		</antcall>

		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.recommendationItemFilter}" />
		</antcall>
		<antcall target="prepareHelper">
			<param name="folder.prefix" value="${projectfolder.futureSalesItemFilter}" />
		</antcall>
	</target>

	<!-- ========================================================== -->
	<!-- Helper target for creating folders. Called by the			-->
	<!-- prepare target.											-->
	<!-- ========================================================== -->
	<target name="prepareHelper" if="folder.prefix">
		<mkdir dir="${folder.prefix}/${folder.bin}" />
		<mkdir dir="${folder.prefix}/${folder.dist}" />
	</target>

	<!-- ========================================================== -->
	<!-- Main target for compiling the different sub-projects.		-->
	<!-- ========================================================== -->
	<target name="compile">
		<echo>Start compiling... 
			Classpath property is set to: ${build.classpath}</echo>
		<antcall target="compile-businessObjects" />
		<antcall target="compile-contracts" />
		<antcall target="compile-entities" />
		<antcall target="compile-persistenceService" />
		<antcall target="compile-queryService" />
		<antcall target="compile-authService" />
		<antcall target="compile-userMgmt" />
		<antcall target="compile-itemMgmt" />
		<antcall target="compile-bidAndBuyService" />
		<antcall target="compile-reputationService" />
		<antcall target="compile-inventoryService" />
		<antcall target="compile-lastSecondSalesItemFilter" />
		<antcall target="compile-pastSalesItemFilter" />
		<antcall target="compile-buyNowItemFilter" />
		<antcall target="compile-availabilityItemFilter" />
		<antcall target="compile-regionItemFilter" />
		<antcall target="compile-sellerReputationItemFilter" />
		<antcall target="compile-commentItemFilter" />
		<antcall target="compile-categoryItemFilter" />
		<antcall target="compile-recommendationItemFilter" />
		<antcall target="compile-futureSalesItemFilter" />
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the business objects used as data transfer		-->
	<!-- objects in other sub-projects.							-->
	<!-- ========================================================== -->
	<target name="compile-businessObjects">
		<echo>Building ${projectfolder.businessObjects}/${folder.src} to ${projectfolder.businessObjects}/${folder.bin}</echo>
		<javac classpath="${build.classpath}" destdir="${projectfolder.businessObjects}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.businessObjects}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the contracts sub-projects containing sources		-->
	<!-- required by several other sub-projects.					-->
	<!-- ========================================================== -->
	<target name="compile-contracts">
		<echo>Building ${projectfolder.contracts}/${folder.src} to ${projectfolder.contracts}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.contracts}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.contracts}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the entities sub-projects containing sources		-->
	<!-- required by several sub-projects, esp. the EJB modules.	-->
	<!-- ========================================================== -->
	<target name="compile-entities">
		<echo>Building ${projectfolder.entities}/${folder.src} to ${projectfolder.entities}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.entities}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.entities}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the persistence service module,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-persistenceService">
		<echo>Building ${projectfolder.persistenceService}/${folder.src} to ${projectfolder.persistenceService}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}:${projectfolder.entities}/${folder.bin}" destdir="${projectfolder.persistenceService}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.persistenceService}/${folder.src}" />
		</javac>
	</target>


	<!-- ========================================================== -->
	<!-- Compiles the user query service module,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-queryService">
		<echo>Building ${projectfolder.queryService}/${folder.src} to ${projectfolder.queryService}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.entities}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.queryService}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.queryService}/${folder.src}" />
		</javac>
	</target>


	<!-- ========================================================== -->
	<!-- Compiles the authentication service module,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-authService">
		<echo>Building ${projectfolder.authService}/${folder.src} to ${projectfolder.authService}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.authService}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.authService}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the user management service module,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-userMgmt">
		<echo>Building ${projectfolder.userMgmt}/${folder.src} to ${projectfolder.userMgmt}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.userMgmt}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.userMgmt}/${folder.src}" />
		</javac>
	</target>



	<!-- ========================================================== -->
	<!-- Compiles the item management service module,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-itemMgmt">
		<echo>Building ${projectfolder.itemMgmt}/${folder.src} to ${projectfolder.itemMgmt}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.itemMgmt}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.itemMgmt}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the bid and buy service module,					-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-bidAndBuyService">
		<echo>Building ${projectfolder.bidAndBuyService}/${folder.src} to ${projectfolder.bidAndBuyService}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.bidAndBuyService}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.bidAndBuyService}/${folder.src}" />
		</javac>
	</target>


	<!-- ========================================================== -->
	<!-- Compiles the reputation service module,					-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-reputationService">
		<echo>Building ${projectfolder.reputationService}/${folder.src} to ${projectfolder.reputationService}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.reputationService}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.reputationService}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the inventory service module,						-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-inventoryService">
		<echo>Building ${projectfolder.inventoryMgmt}/${folder.src} to ${projectfolder.inventoryMgmt}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.inventoryMgmt}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.inventoryMgmt}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the last second sales item filter,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-lastSecondSalesItemFilter">
		<echo>Building ${projectfolder.lastSecondSalesItemFilter}/${folder.src} to ${projectfolder.lastSecondSalesItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.lastSecondSalesItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.lastSecondSalesItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the past sales item filter,						-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-pastSalesItemFilter">
		<echo>Building ${projectfolder.pastSalesItemFilter}/${folder.src} to ${projectfolder.pastSalesItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.pastSalesItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.pastSalesItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the buy now item filter,							-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-buyNowItemFilter">
		<echo>Building ${projectfolder.buyNowItemFilter}/${folder.src} to ${projectfolder.buyNowItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.buyNowItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.buyNowItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the availability item filter,						-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-availabilityItemFilter">
		<echo>Building ${projectfolder.availabilityItemFilter}/${folder.src} to ${projectfolder.availabilityItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.availabilityItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.availabilityItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the region item filter,							-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-regionItemFilter">
		<echo>Building ${projectfolder.regionItemFilter}/${folder.src} to ${projectfolder.regionItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.regionItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.regionItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the seller reputation item filter,				-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-sellerReputationItemFilter">
		<echo>Building ${projectfolder.sellerReputationItemFilter}/${folder.src} to ${projectfolder.sellerReputationItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.sellerReputationItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.sellerReputationItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the comment item filter,							-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-commentItemFilter">
		<echo>Building ${projectfolder.commentItemFilter}/${folder.src} to ${projectfolder.commentItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.commentItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.commentItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the category item filter,							-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-categoryItemFilter">
		<echo>Building ${projectfolder.categoryItemFilter}/${folder.src} to ${projectfolder.categoryItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.categoryItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.categoryItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the recommendation item filter,					-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-recommendationItemFilter">
		<echo>Building ${projectfolder.recommendationItemFilter}/${folder.src} to ${projectfolder.recommendationItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.recommendationItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.recommendationItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Compiles the future sales item filter,						-->
	<!-- (a sub-project and component of mRUBiS).					-->
	<!-- ========================================================== -->
	<target name="compile-futureSalesItemFilter">
		<echo>Building ${projectfolder.futureSalesItemFilter}/${folder.src} to ${projectfolder.futureSalesItemFilter}/${folder.bin}</echo>
		<javac classpath="${build.classpath}:${projectfolder.contracts}/${folder.bin}:${projectfolder.businessObjects}/${folder.bin}" destdir="${projectfolder.futureSalesItemFilter}/${folder.bin}" debug="on" source="${mrubis.java.version.source}" target="${mrubis.java.version.target}">
			<src path="${projectfolder.futureSalesItemFilter}/${folder.src}" />
		</javac>
	</target>

	<!-- ========================================================== -->
	<!-- Main target for building the jar files.					-->
	<!-- ========================================================== -->
	<target name="package">
		<antcall target="package-contracts" />
		<antcall target="package-persistenceService" />
		<antcall target="package-queryService" />
		<antcall target="package-authService" />
		<antcall target="package-userMgmt" />
		<antcall target="package-itemMgmt" />
		<antcall target="package-bidAndBuyService" />
		<antcall target="package-reputationService" />
		<antcall target="package-inventoryService" />
		<antcall target="package-lastSecondSalesItemFilter" />
		<antcall target="package-pastSalesItemFilter" />
		<antcall target="package-buyNowItemFilter" />
		<antcall target="package-availabilityItemFilter" />
		<antcall target="package-regionItemFilter" />
		<antcall target="package-sellerRegionItemFilter" />
		<antcall target="package-commentItemFilter" />
		<antcall target="package-categoryItemFilter" />
		<antcall target="package-recommendationItemFilter" />
		<antcall target="package-futureSalesItemFilter" />
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the persistence service.			-->
	<!-- ========================================================== -->
	<target name="package-contracts">
		<echo>Creating JAR for the Contracts (only to be used as a library, not for deployment)</echo>
		<tstamp>
		     <format property="time.stamp" pattern="yyyyMMdd_HHmmss"/>
		</tstamp>
		<jar destfile="${projectfolder.contracts}/${folder.dist}/${name.project}-contracts-${time.stamp}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
		</jar>
	</target>


	<!-- ========================================================== -->
	<!-- Builds the jar file for the persistence service.			-->
	<!-- ========================================================== -->
	<target name="package-persistenceService">
		<echo>Creating JAR for the Persistence Service...</echo>
		<jar destfile="${projectfolder.persistenceService}/${folder.dist}/${name.project}-${module.persistenceService}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.persistenceService}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.persistenceService}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
			<!-- entities -->
			<fileset dir="${projectfolder.entities}/${folder.bin}" />
			<fileset dir="${projectfolder.entities}/${folder.res}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the query service.		-->
	<!-- ========================================================== -->
	<target name="package-queryService">
		<echo>Creating JAR for the Query Service...</echo>
		<jar destfile="${projectfolder.queryService}/${folder.dist}/${name.project}-${module.queryService}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.queryService}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.queryService}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
			<!-- entities -->
			<fileset dir="${projectfolder.entities}/${folder.bin}" />
			<fileset dir="${projectfolder.entities}/${folder.res}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the authentication service.		-->
	<!-- ========================================================== -->
	<target name="package-authService">
		<echo>Creating JAR for the Authentication Service...</echo>
		<jar destfile="${projectfolder.authService}/${folder.dist}/${name.project}-${module.authService}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.authService}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.authService}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the usermanagemt service.		-->
	<!-- ========================================================== -->
	<target name="package-userMgmt">
		<echo>Creating JAR for the User Management Service...</echo>
		<jar destfile="${projectfolder.userMgmt}/${folder.dist}/${name.project}-${module.userMgmt}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.userMgmt}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.userMgmt}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the item management service.		-->
	<!-- ========================================================== -->
	<target name="package-itemMgmt">
		<echo>Creating JAR for the Item Management Service...</echo>
		<jar destfile="${projectfolder.itemMgmt}/${folder.dist}/${name.project}-${module.itemMgmt}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.itemMgmt}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.itemMgmt}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the bid and buy service.			-->
	<!-- ========================================================== -->
	<target name="package-bidAndBuyService">
		<echo>Creating JAR for the Bid and Buy Service...</echo>
		<jar destfile="${projectfolder.bidAndBuyService}/${folder.dist}/${name.project}-${module.bidAndBuyService}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.bidAndBuyService}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.bidAndBuyService}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>


	<!-- ========================================================== -->
	<!-- Builds the jar file for the reputation service.			-->
	<!-- ========================================================== -->
	<target name="package-reputationService">
		<echo>Creating JAR for the Reputation Service...</echo>
		<jar destfile="${projectfolder.reputationService}/${folder.dist}/${name.project}-${module.reputationService}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.reputationService}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.reputationService}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the inventory service.				-->
	<!-- ========================================================== -->
	<target name="package-inventoryService">
		<echo>Creating JAR for the Inventory Service...</echo>
		<jar destfile="${projectfolder.inventoryMgmt}/${folder.dist}/${name.project}-${module.inventoryMgmt}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.inventoryMgmt}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.inventoryMgmt}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>


	<!-- ========================================================== -->
	<!-- Builds the jar file for the last second sales item filter.	-->
	<!-- ========================================================== -->
	<target name="package-lastSecondSalesItemFilter">
		<echo>Creating JAR for the Last Second Sales Item Filter...</echo>
		<jar destfile="${projectfolder.lastSecondSalesItemFilter}/${folder.dist}/${name.project}-${module.lastSecondSalesItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.lastSecondSalesItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.lastSecondSalesItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the past sales item filter.		-->
	<!-- ========================================================== -->
	<target name="package-pastSalesItemFilter">
		<echo>Creating JAR for the Past Sales Item Filter...</echo>
		<jar destfile="${projectfolder.pastSalesItemFilter}/${folder.dist}/${name.project}-${module.pastSalesItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.pastSalesItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.pastSalesItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the past sales item filter.		-->
	<!-- ========================================================== -->
	<target name="package-buyNowItemFilter">
		<echo>Creating JAR for the Buy-Now Item Filter...</echo>
		<jar destfile="${projectfolder.buyNowItemFilter}/${folder.dist}/${name.project}-${module.buyNowItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.buyNowItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.buyNowItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the availability item filter.		-->
	<!-- ========================================================== -->
	<target name="package-availabilityItemFilter">
		<echo>Creating JAR for the Availability Item Filter...</echo>
		<jar destfile="${projectfolder.availabilityItemFilter}/${folder.dist}/${name.project}-${module.availabilityItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.availabilityItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.availabilityItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the region item filter.		-->
	<!-- ========================================================== -->
	<target name="package-regionItemFilter">
		<echo>Creating JAR for the Region Item Filter...</echo>
		<jar destfile="${projectfolder.regionItemFilter}/${folder.dist}/${name.project}-${module.regionItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.regionItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.regionItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>


	<!-- ========================================================== -->
	<!-- Builds the jar file for the region item filter.		-->
	<!-- ========================================================== -->
	<target name="package-sellerRegionItemFilter">
		<echo>Creating JAR for the Seller Reputation Item Filter...</echo>
		<jar destfile="${projectfolder.sellerReputationItemFilter}/${folder.dist}/${name.project}-${module.sellerReputationItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.sellerReputationItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.sellerReputationItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the comment item filter.			-->
	<!-- ========================================================== -->
	<target name="package-commentItemFilter">
		<echo>Creating JAR for the Comment Item Filter...</echo>
		<jar destfile="${projectfolder.commentItemFilter}/${folder.dist}/${name.project}-${module.commentItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.commentItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.commentItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the category item filter.			-->
	<!-- ========================================================== -->
	<target name="package-categoryItemFilter">
		<echo>Creating JAR for the Category Item Filter...</echo>
		<jar destfile="${projectfolder.categoryItemFilter}/${folder.dist}/${name.project}-${module.categoryItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.categoryItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.categoryItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the recommendation item filter.	-->
	<!-- ========================================================== -->
	<target name="package-recommendationItemFilter">
		<echo>Creating JAR for the Recommentation Item Filter...</echo>
		<jar destfile="${projectfolder.recommendationItemFilter}/${folder.dist}/${name.project}-${module.recommendationItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.recommendationItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.recommendationItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Builds the jar file for the future sales item filter.		-->
	<!-- ========================================================== -->
	<target name="package-futureSalesItemFilter">
		<echo>Creating JAR for the Future Sales Item Filter...</echo>
		<jar destfile="${projectfolder.futureSalesItemFilter}/${folder.dist}/${name.project}-${module.futureSalesItemFilter}.jar">
			<!-- binaries of the service -->
			<fileset dir="${projectfolder.futureSalesItemFilter}/${folder.bin}" />
			<!-- resources of the service -->
			<fileset dir="${projectfolder.futureSalesItemFilter}/${folder.res}" />
			<!-- business objects -->
			<fileset dir="${projectfolder.businessObjects}/${folder.bin}" />
			<!-- contracts -->
			<fileset dir="${projectfolder.contracts}/${folder.bin}" />
		</jar>
	</target>

	<!-- ========================================================== -->
	<!-- Copies the built jars to the main distribution folder.		-->
	<!-- ========================================================== -->
	<target name="distribute">
		<copy todir="${folder.dist}">
			<fileset dir="${projectfolder.contracts}/${folder.dist}">
				<include name="${name.project}-contracts-*.jar" />
			</fileset>
			<fileset dir="${projectfolder.persistenceService}/${folder.dist}">
				<include name="${name.project}-${module.persistenceService}.jar" />
			</fileset>
			<fileset dir="${projectfolder.queryService}/${folder.dist}">
				<include name="${name.project}-${module.queryService}.jar" />
			</fileset>
			<fileset dir="${projectfolder.authService}/${folder.dist}">
				<include name="${name.project}-${module.authService}.jar" />
			</fileset>
			<fileset dir="${projectfolder.userMgmt}/${folder.dist}">
				<include name="${name.project}-${module.userMgmt}.jar" />
			</fileset>
			<fileset dir="${projectfolder.itemMgmt}/${folder.dist}">
				<include name="${name.project}-${module.itemMgmt}.jar" />
			</fileset>
			<fileset dir="${projectfolder.bidAndBuyService}/${folder.dist}">
				<include name="${name.project}-${module.bidAndBuyService}.jar" />
			</fileset>
			<fileset dir="${projectfolder.reputationService}/${folder.dist}">
				<include name="${name.project}-${module.reputationService}.jar" />
			</fileset>
			<fileset dir="${projectfolder.inventoryMgmt}/${folder.dist}">
				<include name="${name.project}-${module.inventoryMgmt}.jar" />
			</fileset>
			<fileset dir="${projectfolder.lastSecondSalesItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.lastSecondSalesItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.pastSalesItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.pastSalesItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.buyNowItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.buyNowItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.availabilityItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.availabilityItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.regionItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.regionItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.sellerReputationItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.sellerReputationItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.commentItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.commentItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.categoryItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.categoryItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.recommendationItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.recommendationItemFilter}.jar" />
			</fileset>
			<fileset dir="${projectfolder.futureSalesItemFilter}/${folder.dist}">
				<include name="${name.project}-${module.futureSalesItemFilter}.jar" />
			</fileset>
		</copy>
	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- Deploys all mRUBiS components 								-->
	<!-- ========================================================== -->
	<target name="deploy">
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.persistenceService}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.queryService}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.authService}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.userMgmt}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.itemMgmt}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.bidAndBuyService}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.reputationService}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.inventoryMgmt}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.lastSecondSalesItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.pastSalesItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.buyNowItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.availabilityItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.regionItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.sellerReputationItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.commentItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.categoryItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.recommendationItemFilter}.jar" />
		</antcall>
		<antcall target="deployEjbModule">
			<param name="module" value="${folder.dist}/${name.project}-${module.futureSalesItemFilter}.jar" />
		</antcall>
	</target>

	<target name="deployEjbModule" if="module">
		<echo>Start deploying ${module} ...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="deploy" />
			<arg value="${module}" />
		</exec>
	</target>

	<!-- ========================================================== -->
	<!-- Undeploys all mRUBiS components 							-->
	<!-- ========================================================== -->
	<target name="undeploy">
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.persistenceService}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.queryService}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.authService}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.userMgmt}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.itemMgmt}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.bidAndBuyService}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.reputationService}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.inventoryMgmt}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.lastSecondSalesItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.pastSalesItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.buyNowItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.availabilityItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.regionItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.sellerReputationItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.commentItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.categoryItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.recommendationItemFilter}" />
		</antcall>
		<antcall target="undeployEjbModule">
			<param name="module" value="${name.project}-${module.futureSalesItemFilter}" />
		</antcall>
	</target>

	<target name="undeployEjbModule" if="module">
		<echo>Start undeploying ${module} ...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="undeploy" />
			<arg value="${module}" />
		</exec>
	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- mRUBiS database 											-->
	<!-- ========================================================== -->
	<path id="database-libraries">
		<fileset dir="${database.lib}">
			<include name="*.jar" />
		</fileset>
	</path>

	<!-- Database setup -->
	<target name="setup-database">
		<antcall target="create-database" />
		<sleep milliseconds="5000" />
		<antcall target="insert-data" />
	</target>
	<!-- Reset data in the database -->
	<target name="reset-database">
		<antcall target="delete-data" />
		<sleep milliseconds="2500" />
		<antcall target="insert-data" />
	</target>
	<!-- Database cleanup -->
	<target name="cleanup-database">
		<antcall target="drop-database" />
	</target>

	<!-- Creates the database schema -->
	<target name="create-database">
		<!-- delete directory storing the database -->
		<delete quiet="true" failonerror="false" dir="${database.folder}/${database.name}" />
		<java fork="true" classname="org.apache.derby.tools.ij" classpathref="database-libraries">
			<sysproperty key="ij.connection.${database.name}-conn" value="${database.url}create=true" />
			<sysproperty key="derby.system.home" value="${database.folder}" />
			<arg value="${sql.dir}/${sql.file.create}" />
		</java>
	</target>
	<!-- Inserts test data to the database -->
	<target name="insert-data">
		<java fork="true" classname="org.apache.derby.tools.ij" classpathref="database-libraries">
			<sysproperty key="ij.connection.${database.name}-conn" value="${database.url}" />
			<sysproperty key="derby.system.home" value="${database.folder}" />
			<arg value="${sql.dir}/${sql.file.insertdata}" />
		</java>
	</target>
	<!-- Deletes all data from the database -->
	<target name="delete-data">
		<java fork="true" classname="org.apache.derby.tools.ij" classpathref="database-libraries">
			<sysproperty key="ij.connection.${database.name}-conn" value="${database.url}" />
			<sysproperty key="derby.system.home" value="${database.folder}" />
			<arg value="${sql.dir}/${sql.file.deletedata}" />
		</java>
	</target>
	<!-- Drops the database schema -->
	<target name="drop-database">
		<java fork="true" classname="org.apache.derby.tools.ij" classpathref="database-libraries">
			<sysproperty key="ij.connection.${database.name}-conn" value="${database.url}" />
			<sysproperty key="derby.system.home" value="${database.folder}" />
			<arg value="${sql.dir}/${sql.file.drop}" />
		</java>
		<!-- delete directory storing the database -->
		<delete quiet="true" failonerror="false" dir="${database.folder}/${database.name}" />
	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- Install mRUBiS and database 								-->
	<!-- ========================================================== -->
	<target name="install" depends="build">
		<antcall target="setup-database" />
		<antcall target="deploy" />
	</target>

	<!-- ========================================================== -->
	<!-- Uninstall mRUBiS and database 								-->
	<!-- ========================================================== -->
	<target name="uninstall">
		<antcall target="cleanup-database" />
		<antcall target="undeploy" />
	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

	<!-- ========================================================== -->
	<!-- Start, Stop, Restart Glassfish Domain and Database Server	-->
	<!-- ========================================================== -->
	<target name="start-domain">
		<echo>Starting Glassfish Domain...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="start-domain" />
			<arg value="domain1" />
		</exec>
	</target>

	<target name="stop-domain">
		<echo>Stopping Glassfish Domain...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="stop-domain" />
			<arg value="domain1" />
		</exec>
	</target>

	<target name="start-database">
		<echo>Starting database server...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="start-database" />
		</exec>
	</target>

	<target name="stop-database">
		<echo>Stopping database server...</echo>
		<exec executable="${glassfish.home}/bin/asadmin">
			<arg value="stop-database" />
		</exec>
	</target>

	<target name="start-server">
		<antcall target="start-database" />
		<antcall target="start-domain" />
	</target>

	<target name="stop-server">
		<antcall target="stop-domain" />
		<antcall target="stop-database" />
	</target>

	<target name="restart-server">
		<antcall target="stop-server" />
		<antcall target="start-server" />
	</target>

	<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
</project>
